# è‹±æ–‡æ–‡ç« é˜…è¯»å™¨ - å®Œæ•´éƒ¨ç½²è¯´æ˜

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
paperread/
â”œâ”€â”€ backend/                 # Djangoé¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py         # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ urls.py             # ä¸»è·¯ç”±
â”‚   â””â”€â”€ wsgi.py
â”œâ”€â”€ articles/               # æ–‡ç« åº”ç”¨
â”‚   â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ serializers.py     # åºåˆ—åŒ–å™¨
â”‚   â”œâ”€â”€ views.py           # è§†å›¾
â”‚   â”œâ”€â”€ urls.py            # è·¯ç”±
â”‚   â””â”€â”€ admin.py           # ç®¡ç†åå°
â”œâ”€â”€ manage.py              # Djangoç®¡ç†è„šæœ¬
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â”œâ”€â”€ index.html            # å‰ç«¯é¡µé¢
â”œâ”€â”€ script.js             # å‰ç«¯è„šæœ¬
â””â”€â”€ style.css             # å‰ç«¯æ ·å¼
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤1: æ•°æ®åº“è¿ç§»

```bash
cd /Users/guolei/work/local/stpython/paperread
python manage.py makemigrations
python manage.py migrate
```

### æ­¥éª¤2: åˆ›å»ºç®¡ç†å‘˜è´¦å·

```bash
python manage.py createsuperuser
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- ç”¨æˆ·å
- é‚®ç®±
- å¯†ç 

### æ­¥éª¤3: å¯åŠ¨åç«¯æœåŠ¡å™¨

```bash
python manage.py runserver
```

åç«¯è¿è¡Œåœ¨ï¼šhttp://localhost:8000

### æ­¥éª¤4: è®¿é—®å‰ç«¯

ç›´æ¥æ‰“å¼€ `index.html` æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ç®€å•çš„HTTPæœåŠ¡å™¨ï¼š

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Python
python -m http.server 8080

# æ–¹å¼2ï¼šä½¿ç”¨å…¶ä»–HTTPæœåŠ¡å™¨
# ç„¶åè®¿é—® http://localhost:8080
```

## ğŸ“¡ APIæµ‹è¯•

### æµ‹è¯•åç«¯æ˜¯å¦è¿è¡Œ

è®¿é—®ï¼šhttp://localhost:8000/api/articles/

åº”è¯¥çœ‹åˆ°ä¸€ä¸ªJSONå“åº”ï¼ˆå¯èƒ½æ˜¯ç©ºåˆ—è¡¨ï¼‰ã€‚

### è®¿é—®ç®¡ç†åå°

è®¿é—®ï¼šhttp://localhost:8000/admin/

ä½¿ç”¨åˆšæ‰åˆ›å»ºçš„ç®¡ç†å‘˜è´¦å·ç™»å½•ã€‚

## ğŸ“ æ·»åŠ ç¤ºä¾‹æ–‡ç« 

### æ–¹å¼1ï¼šé€šè¿‡ç®¡ç†åå°

1. è®¿é—® http://localhost:8000/admin/
2. ç‚¹å‡»"æ–‡ç« " â†’ "æ·»åŠ æ–‡ç« "
3. å¡«å†™ï¼š
   - æ ‡é¢˜ï¼šThe Importance of AI
   - å†…å®¹ï¼šç²˜è´´è‹±æ–‡æ–‡ç« 
   - éš¾åº¦ï¼šé€‰æ‹© intermediate
   - åˆ†ç±»ï¼šTechnology
4. ç‚¹å‡»"ä¿å­˜"

### æ–¹å¼2ï¼šé€šè¿‡API

```bash
curl -X POST http://localhost:8000/api/articles/ \
  -H "Content-Type: application/json" \
  -d '{
    "title": "The Future of AI",
    "content": "Artificial intelligence is rapidly evolving...",
    "difficulty": "intermediate",
    "category": "Technology"
  }'
```

### æ–¹å¼3ï¼šé€šè¿‡Django Shell

```bash
python manage.py shell
```

```python
from articles.models import Article

Article.objects.create(
    title="Sample Article",
    content="This is a sample article...",
    difficulty="beginner",
    category="General"
)
```

## ğŸ”„ ä¿®æ”¹å‰ç«¯è¿æ¥åç«¯

éœ€è¦ä¿®æ”¹ `script.js`ï¼Œæ·»åŠ APIè°ƒç”¨åŠŸèƒ½ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„APIæ¨¡å—ï¼š

```javascript
// åœ¨script.jsé¡¶éƒ¨æ·»åŠ 
const API_BASE_URL = 'http://localhost:8000/api';

// è·å–æ–‡ç« åˆ—è¡¨
async function fetchArticles() {
    const response = await fetch(`${API_BASE_URL}/articles/`);
    return await response.json();
}

// è·å–æ–‡ç« è¯¦æƒ…
async function fetchArticle(id) {
    const response = await fetch(`${API_BASE_URL}/articles/${id}/`);
    return await response.json();
}

// ä¿å­˜é˜…è¯»å†å²
async function saveReadingHistory(articleId, duration) {
    await fetch(`${API_BASE_URL}/articles/${articleId}/record_reading/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ read_duration: duration })
    });
}

// ä¿å­˜æ ‡æ³¨
async function saveAnnotations(articleId, annotations) {
    await fetch(`${API_BASE_URL}/articles/${articleId}/save_annotations/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ annotations })
    });
}

// è·å–æ ‡æ³¨
async function loadAnnotations(articleId) {
    const response = await fetch(`${API_BASE_URL}/articles/${articleId}/annotations/`);
    return await response.json();
}
```

## ğŸ¯ åŠŸèƒ½æ•´åˆå»ºè®®

### 1. æ·»åŠ æ–‡ç« é€‰æ‹©å™¨

åœ¨HTMLä¸­æ·»åŠ ï¼š

```html
<div class="article-selector">
    <label>é€‰æ‹©æ–‡ç« ï¼š</label>
    <select id="articleSelect">
        <option value="">åŠ è½½ä¸­...</option>
    </select>
</div>
```

### 2. ä»åç«¯åŠ è½½æ–‡ç« åˆ—è¡¨

```javascript
// é¡µé¢åŠ è½½æ—¶è·å–æ–‡ç« åˆ—è¡¨
async function loadArticleList() {
    const data = await fetchArticles();
    const select = document.getElementById('articleSelect');
    select.innerHTML = '<option value="">è¯·é€‰æ‹©æ–‡ç« </option>';
    
    data.results.forEach(article => {
        const option = document.createElement('option');
        option.value = article.id;
        option.textContent = article.title;
        select.appendChild(option);
    });
}

// é€‰æ‹©æ–‡ç« æ—¶åŠ è½½å†…å®¹
document.getElementById('articleSelect').addEventListener('change', async (e) => {
    const articleId = e.target.value;
    if (articleId) {
        const article = await fetchArticle(articleId);
        articleInput.value = article.content;
        handleArticleInput();
        
        // åŠ è½½ä¹‹å‰çš„æ ‡æ³¨
        const annotations = await loadAnnotations(articleId);
        // æ¢å¤æ ‡æ³¨...
    }
});
```

### 3. è‡ªåŠ¨ä¿å­˜æ ‡æ³¨

```javascript
// åœ¨æ ‡æ³¨æ›´æ”¹æ—¶è‡ªåŠ¨ä¿å­˜
async function autoSaveAnnotations() {
    const articleId = getCurrentArticleId();
    if (articleId && annotatedWords.size > 0) {
        const annotations = Array.from(annotatedWords.entries()).map(([word, color]) => ({
            word,
            color
        }));
        await saveAnnotations(articleId, annotations);
    }
}

// åœ¨toggleAnnotationå‡½æ•°ä¸­æ·»åŠ 
function toggleAnnotation(word) {
    // ... åŸæœ‰ä»£ç  ...
    
    // è‡ªåŠ¨ä¿å­˜
    autoSaveAnnotations();
}
```

## ğŸ”§ å¼€å‘ç¯å¢ƒvsç”Ÿäº§ç¯å¢ƒ

### å¼€å‘ç¯å¢ƒï¼ˆå½“å‰ï¼‰
- Debugæ¨¡å¼å¼€å¯
- ä½¿ç”¨SQLiteæ•°æ®åº“
- å…è®¸æ‰€æœ‰CORSæ¥æº
- SECRET_KEYæš´éœ²

### ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¿®æ”¹

1. **settings.py**:
```python
DEBUG = False
ALLOWED_HOSTS = ['yourdomain.com']
CORS_ALLOWED_ORIGINS = [
    'https://yourdomain.com',
]
```

2. **ä½¿ç”¨ç¯å¢ƒå˜é‡**:
```python
import os
SECRET_KEY = os.environ.get('DJANGO_SECRET_KEY')
```

3. **ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“**ï¼ˆPostgreSQLæ¨èï¼‰

4. **é…ç½®é™æ€æ–‡ä»¶æœåŠ¡**

5. **ä½¿ç”¨Gunicorn/uWSGI + Nginx**

## ğŸ“Š æ•°æ®åº“ç®¡ç†

### æŸ¥çœ‹æ•°æ®

```bash
python manage.py shell
```

```python
from articles.models import Article, ReadingHistory, Annotation

# æŸ¥çœ‹æ‰€æœ‰æ–‡ç« 
Article.objects.all()

# æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„é˜…è¯»å†å²
ReadingHistory.objects.filter(article_id=1)

# æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„æ ‡æ³¨
Annotation.objects.filter(article_id=1)
```

### æ¸…ç©ºæ•°æ®

```python
# æ¸…ç©ºæ‰€æœ‰æ–‡ç« 
Article.objects.all().delete()

# æ¸…ç©ºé˜…è¯»å†å²
ReadingHistory.objects.all().delete()

# æ¸…ç©ºæ ‡æ³¨
Annotation.objects.all().delete()
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. CORSé”™è¯¯

ç¡®ä¿ `django-cors-headers` å·²å®‰è£…ï¼Œå¹¶åœ¨ settings.py ä¸­æ­£ç¡®é…ç½®ã€‚

### 2. æ•°æ®åº“locked

SQLiteåœ¨é«˜å¹¶å‘æ—¶å¯èƒ½å‡ºç°æ­¤é—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨PostgreSQLã€‚

### 3. é™æ€æ–‡ä»¶404

å¼€å‘ç¯å¢ƒä¸‹Djangoä¼šè‡ªåŠ¨å¤„ç†ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®ã€‚

### 4. APIè¿”å›404

æ£€æŸ¥URLé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿articlesåº”ç”¨å·²æ³¨å†Œã€‚

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ æœ‰ä¸€ä¸ªå®Œæ•´çš„å‰åç«¯åˆ†ç¦»çš„è‹±æ–‡æ–‡ç« é˜…è¯»å™¨ï¼š

âœ… Django REST APIåç«¯
âœ… æ•°æ®åº“å­˜å‚¨æ–‡ç« 
âœ… ç”¨æˆ·æ ‡æ³¨ä¿å­˜
âœ… é˜…è¯»å†å²è¿½è¸ª
âœ… ç®¡ç†åå°
âœ… å®Œæ•´çš„å‰ç«¯ç•Œé¢

å¼€å§‹ä½¿ç”¨å§ï¼

