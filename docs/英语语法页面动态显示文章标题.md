# 英语语法页面动态显示文章标题

## 📋 更新概述

将英语语法页面中的固定文本"文章内容"替换为动态显示的文章标题，让用户更清楚地知道当前正在阅读的文章。

## 🔄 更改内容

### 之前的显示

页面顶部始终显示固定文本：

```
┌────────────────────────────────────┐
│ 文章内容                            │
│ [清除格式]                          │
│ □ 单词标注  □ 句子标注  □ 翻译模式  │
├────────────────────────────────────┤
│ [文章正文内容...]                   │
└────────────────────────────────────┘
```

### 现在的显示

页面顶部动态显示实际的文章标题：

```
┌────────────────────────────────────┐
│ 英语时态详解                        │  ← 动态显示文章标题
│ [清除格式]                          │
│ □ 单词标注  □ 句子标注  □ 翻译模式  │
├────────────────────────────────────┤
│ [文章正文内容...]                   │
└────────────────────────────────────┘
```

## ✨ 功能特点

### 1. 动态更新

标题会在以下情况自动更新：

- ✅ 通过 URL 参数加载文章时
- ✅ 从左侧目录点击文章时
- ✅ 页面首次自动加载第一篇文章时

### 2. 默认值

如果没有加载任何文章，标题显示为默认值"文章内容"。

### 3. 用户体验提升

- 📚 用户清楚地知道当前阅读的文章标题
- 🎯 方便识别和区分不同的语法文章
- 💡 提供更好的上下文信息

## 🔧 技术实现

### 1. HTML 更改

**文件**: `grammar.html`

为标题元素添加了 `id` 属性，使其可以通过 JavaScript 动态更新：

```html
<!-- 修改前 -->
<h2>文章内容</h2>

<!-- 修改后 -->
<h2 id="articleTitle">文章内容</h2>
```

### 2. JavaScript 更改

**文件**: `grammar.js`

#### 添加 DOM 元素引用

```javascript
// DOM元素
const articleDisplay = document.getElementById('articleDisplay');
const articleTitle = document.getElementById('articleTitle');  // 新增
const wordList = document.getElementById('wordList');
```

#### 在 loadArticleFromURL() 中更新标题

```javascript
async function loadArticleFromURL() {
    // ... URL 参数解析
    
    try {
        const response = await fetch(`${API_BASE_URL}/grammar-articles/${articleId}/`);
        if (response.ok) {
            const article = await response.json();
            currentArticleId = article.id;
            currentParagraphCount = article.paragraph_count || 0;
            
            // 🆕 更新文章标题
            if (articleTitle && article.title) {
                articleTitle.textContent = article.title;
            }
            
            // ... 加载文章内容
        }
    } catch (error) {
        console.error('加载文章失败:', error);
    }
}
```

#### 在 loadArticleById() 中更新标题

```javascript
async function loadArticleById(articleId) {
    currentArticleId = articleId;
    
    // 🆕 获取文章信息（包括标题）
    try {
        const response = await fetch(`${API_BASE_URL}/grammar-articles/${articleId}/`);
        if (response.ok) {
            const article = await response.json();
            // 更新文章标题
            if (articleTitle && article.title) {
                articleTitle.textContent = article.title;
            }
        }
    } catch (error) {
        console.error('获取文章信息失败:', error);
    }
    
    // ... 加载文章内容和更新UI
}
```

#### 在 selectArticle() 中更新标题

```javascript
async function selectArticle(articleId) {  // 🆕 改为 async
    currentArticleId = articleId;
    
    // 🆕 获取文章信息（包括标题）
    try {
        const response = await fetch(`${API_BASE_URL}/grammar-articles/${articleId}/`);
        if (response.ok) {
            const article = await response.json();
            // 更新文章标题
            if (articleTitle && article.title) {
                articleTitle.textContent = article.title;
            }
        }
    } catch (error) {
        console.error('获取文章信息失败:', error);
    }
    
    // ... 更新活动状态和加载内容
}
```

## 📊 更新时机

### 触发标题更新的场景

| 场景 | 触发函数 | API 调用 | 标题来源 |
|------|---------|---------|---------|
| URL 加载 | `loadArticleFromURL()` | `/grammar-articles/{id}/` | `article.title` |
| 目录点击 | `selectArticle(id)` | `/grammar-articles/{id}/` | `article.title` |
| 自动加载第一篇 | `loadArticleById(id)` | `/grammar-articles/{id}/` | `article.title` |

### 数据流程

```
用户操作
    ↓
调用相关函数
    ↓
请求 API 获取文章详情
    ↓
解析响应数据 (article.title)
    ↓
更新 DOM 元素
    ↓
用户看到文章标题
```

## 🎨 界面效果示例

### 示例 1: 基础语法文章

```
┌─────────────────────────────────────┐
│ 英语时态详解                         │
│ [清除格式]                           │
│ □ 单词标注  □ 句子标注  □ 翻译模式   │
├─────────────────────────────────────┤
│ 英语共有12种时态，分别是...          │
└─────────────────────────────────────┘
```

### 示例 2: 高级语法文章

```
┌─────────────────────────────────────┐
│ 虚拟语气的使用                       │
│ [清除格式]                           │
│ □ 单词标注  □ 句子标注  □ 翻译模式   │
├─────────────────────────────────────┤
│ 虚拟语气用来表达假设、愿望...        │
└─────────────────────────────────────┘
```

### 示例 3: 未加载文章

```
┌─────────────────────────────────────┐
│ 文章内容                             │  ← 默认文本
│ [清除格式]                           │
│ □ 单词标注  □ 句子标注  □ 翻译模式   │
├─────────────────────────────────────┤
│ [等待选择文章...]                    │
└─────────────────────────────────────┘
```

## 💡 错误处理

### 空值检查

所有标题更新都包含空值检查，确保代码健壮性：

```javascript
if (articleTitle && article.title) {
    articleTitle.textContent = article.title;
}
```

**好处**：
- ✅ 防止 `null` 或 `undefined` 错误
- ✅ 优雅降级：如果元素不存在，不会影响其他功能
- ✅ 兼容性：如果 API 响应没有 title 字段，不会报错

### API 请求失败

如果获取文章信息失败，标题保持不变：

```javascript
try {
    const response = await fetch(...);
    // ... 更新标题
} catch (error) {
    console.error('获取文章信息失败:', error);
    // 标题保持原值，不影响内容显示
}
```

## 🔍 与其他页面的一致性

### 文章阅读页面 (index.html)

- 标题位置：侧边栏单词列表上方
- 标题显示：文章标题 + 作者信息

### 英语语法页面 (grammar.html)

- 标题位置：文章内容区域顶部 ✅
- 标题显示：语法文章标题

**设计考虑**：
- 语法页面的标题更加醒目，因为没有侧边栏单词列表
- 用户的注意力更集中在文章内容区域
- 标题在顶部，提供清晰的页面标识

## 📝 相关文件

### 修改的文件

- `/Users/guolei/work/local/stpython/paperread/grammar.html` - 添加 `id="articleTitle"`
- `/Users/guolei/work/local/stpython/paperread/grammar.js` - 添加标题更新逻辑

### 相关功能

- 文章加载功能 (`loadArticleFromURL`, `loadArticleById`, `selectArticle`)
- 文章目录功能 (`loadCatalog`, `displayCatalog`)
- 默认加载第一篇文章功能

## 🔗 相关文档

- [英语语法页面加载语法文章说明.md](./英语语法页面加载语法文章说明.md) - 语法页面功能
- [英语语法页面默认显示首篇文章.md](./英语语法页面默认显示首篇文章.md) - 自动加载功能
- [英语语法页面移除翻译和控制按钮.md](./英语语法页面移除翻译和控制按钮.md) - 界面简化
- [语法文章跳转英语语法页面说明.md](./语法文章跳转英语语法页面说明.md) - 跳转逻辑

## 🎯 用户体验提升

### 之前

- ❌ 所有文章都显示"文章内容"
- ❌ 用户不知道当前阅读的文章标题
- ❌ 需要返回目录才能确认文章名称

### 现在

- ✅ 动态显示实际的文章标题
- ✅ 用户一眼就能识别当前文章
- ✅ 提供更好的上下文和导航体验

## 📅 更新日志

- **2025-10-25**: 初始版本
  - HTML 中为标题元素添加 `id="articleTitle"`
  - JavaScript 中添加标题 DOM 引用
  - 在 `loadArticleFromURL()` 中添加标题更新逻辑
  - 在 `loadArticleById()` 中添加标题更新逻辑
  - 在 `selectArticle()` 中添加标题更新逻辑
  - 将 `selectArticle()` 改为 async 函数
  - 所有标题更新都包含空值检查

---

**设计理念**：让用户清楚地知道自己正在阅读什么内容，提供更好的上下文和导航体验。✨

