# AI生成功能测试指南

## 功能说明

语法文章页面的新建文章功能已支持AI生成内容。系统会根据用户配置自动使用对应的AI服务。

## 🧪 测试步骤

### 测试1：未配置AI时的行为

**目的**：验证未配置AI时的引导提示

**步骤**：
1. 打开浏览器，按F12打开开发者工具
2. 在Console中执行：`localStorage.removeItem('paperread_ai_config')`
3. 刷新页面
4. 点击"语法文章" → "新建文章"
5. 在AI提示词框输入：`写一篇关于英语时态的文章`
6. 点击"生成内容"

**预期结果**：
- 弹出提示：`您还没有配置AI API。是否前往个人中心配置？`
- 点击"确定"跳转到个人中心
- 点击"取消"停留在当前页面

---

### 测试2：配置AI后使用示例内容

**目的**：验证有配置但未安装SDK或API调用失败时的降级行为

**步骤**：
1. 打开"个人中心"
2. 展开"🤖 AI API 配置"
3. 选择服务商：`DeepSeek 🇨🇳`
4. 输入API密钥：`sk-test-fake-key-12345678901234567890`（假密钥用于测试）
5. 点击"保存配置"
6. 前往"语法文章" → "新建文章"
7. 输入提示词：`写一篇关于英语现在完成时的语法文章`
8. 点击"生成内容"

**预期结果**：
- 显示"正在生成中..."状态
- 2-3秒后显示"生成成功！"
- 文章内容框自动填充内容
- 内容包含：
  - 标题和结构
  - 提示词引用
  - 示例说明
  - 配置指南

---

### 测试3：真实API调用（需要真实密钥）

**目的**：验证真实AI API调用

**前提条件**：
- 已在DeepSeek/OpenAI注册账号
- 已获取真实的API密钥
- 后端已安装：`pip install openai`

**步骤**：
1. 打开"个人中心"
2. 配置真实的API密钥
3. 点击"🧪 测试"按钮验证
4. 前往"语法文章" → "新建文章"
5. 输入详细提示词：
```
写一篇关于英语现在完成时的语法文章，要求：
1. 适合中级学习者
2. 包含定义、构成、用法和例句
3. 约500词
4. 使用正式的教学风格
```
6. 点击"生成内容"

**预期结果**：
- 显示"正在生成中..."
- 5-10秒后显示"生成成功！"
- 内容框自动填充真实的AI生成内容
- 内容符合提示词要求
- 字数统计自动更新

---

### 测试4：错误处理

**目的**：验证各种错误情况的处理

#### 4.1 空提示词
1. 不输入任何内容
2. 直接点击"生成内容"
3. **预期**：提示"请输入提示词"

#### 4.2 API密钥错误
1. 配置错误的API密钥
2. 尝试生成
3. **预期**：显示API错误信息和示例内容

#### 4.3 网络错误
1. 断开网络连接
2. 尝试生成
3. **预期**：显示网络错误提示

---

## 🔍 调试技巧

### 查看控制台日志

打开浏览器开发者工具（F12），查看Console标签：

```javascript
// 查看当前AI配置
const config = localStorage.getItem('paperread_ai_config');
console.log(JSON.parse(config));

// 手动测试API调用
fetch('http://localhost:8000/api/articles/generate_content/', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        prompt: '测试提示词',
        ai_config: JSON.parse(localStorage.getItem('paperread_ai_config'))
    })
})
.then(r => r.json())
.then(data => console.log(data));
```

### 查看网络请求

1. 开发者工具 → Network标签
2. 点击"生成内容"
3. 找到`generate_content`请求
4. 查看：
   - Request Payload（请求数据）
   - Response（响应数据）
   - Status Code（状态码）

### 后端日志

在终端查看Django服务器日志：
```bash
# 查看实时日志
tail -f nohup.out

# 或直接运行服务器查看输出
python manage.py runserver
```

---

## 📊 测试用例总结

| 测试场景 | 配置状态 | SDK状态 | 预期行为 |
|---------|---------|---------|---------|
| 未配置AI | ❌ | - | 引导配置 |
| 配置但SDK未安装 | ✅ | ❌ | 返回示例+安装提示 |
| 配置且SDK已安装但密钥错误 | ✅ | ✅ | 返回示例+错误提示 |
| 完整配置 | ✅ | ✅ | 真实AI生成 |

---

## ✅ 验收标准

功能正常的标志：

1. **未配置时**
   - [ ] 显示配置引导
   - [ ] 可以跳转到个人中心

2. **已配置时**
   - [ ] 自动读取配置
   - [ ] 发送请求到后端
   - [ ] 显示加载状态
   - [ ] 内容自动填充
   - [ ] 字数统计更新

3. **真实API时**
   - [ ] 成功调用AI服务
   - [ ] 生成符合提示词的内容
   - [ ] 内容质量良好

4. **错误处理**
   - [ ] 空提示词有提示
   - [ ] API错误有提示
   - [ ] 网络错误有提示
   - [ ] 降级到示例内容

---

## 🐛 常见问题

### Q1: 点击生成后没有反应

**可能原因**：
- JavaScript错误
- 网络请求被阻止

**解决方法**：
1. 打开Console查看错误
2. 检查Network请求状态
3. 确认后端服务运行中

### Q2: 显示"生成失败"

**可能原因**：
- API密钥错误
- 账户余额不足
- 网络连接问题

**解决方法**：
1. 检查API密钥是否正确
2. 检查账户余额
3. 尝试测试连接

### Q3: 总是返回示例内容

**可能原因**：
- SDK未安装
- API配置未正确传递

**解决方法**：
```bash
# 安装SDK
pip install openai

# 重启服务器
python manage.py runserver
```

---

## 📝 测试报告模板

```markdown
## AI生成功能测试报告

**测试日期**：2025-XX-XX
**测试人员**：XXX
**后端状态**：运行中/未运行
**SDK安装**：已安装/未安装

### 测试结果

| 测试项 | 结果 | 备注 |
|-------|------|------|
| 未配置引导 | ✅/❌ | |
| 配置保存 | ✅/❌ | |
| 内容生成 | ✅/❌ | |
| 真实API | ✅/❌ | |
| 错误处理 | ✅/❌ | |

### 问题记录

1. 问题描述：
   解决方法：

2. 问题描述：
   解决方法：

### 总体评价

功能状态：正常/异常
使用体验：良好/一般/较差
建议改进：
```

---

## 🎯 快速验证命令

在浏览器Console中执行：

```javascript
// 1. 清除配置测试
localStorage.removeItem('paperread_ai_config');
alert('配置已清除，刷新页面测试');

// 2. 设置测试配置
localStorage.setItem('paperread_ai_config', JSON.stringify({
    provider: 'deepseek',
    apiKey: 'sk-test-12345678901234567890',
    customUrl: null
}));
alert('测试配置已设置');

// 3. 查看当前配置
console.log('当前AI配置：', 
    JSON.parse(localStorage.getItem('paperread_ai_config') || '{}')
);
```

---

**测试完成后请填写测试报告并反馈问题！**

