# 文章导入脚本使用说明

## 📖 功能说明

`import_articles.py` 是一个强大的文章导入工具，支持：

- ✅ 单个文件导入
- ✅ 批量目录导入
- ✅ 自动检测文章元数据（标题、分类、难度）
- ✅ 书籍章节自动分割
- ✅ 多种文件编码支持（UTF-8, GBK, GB2312等）
- ✅ 自动计算单词数和段落数

## 🚀 快速开始

### 1. 导入单个文章

```bash
python import_articles.py --file sample_article.txt
```

**输出示例**：
```
============================================================
📖 正在导入: sample_article.txt
============================================================
✓ 使用编码 utf-8 成功读取文件

✓ 导入成功!
  标题: The Benefits of Regular Exercise
  分类: 健康
  难度: 中级
  单词数: 856
  段落数: 10
  ID: 7
```

### 2. 导入书籍（自动分章节）

```bash
python import_articles.py --file sample_book.txt --detect-chapters --title "机器学习入门"
```

**输出示例**：
```
📚 检测书籍章节: sample_book.txt
✓ 检测到 4 个章节 (模式: Chapter\s+\d+)

============================================================
📖 正在导入: /tmp/chapter_1.txt
============================================================
✓ 导入成功!
  标题: 机器学习入门 - Chapter 1: What is Machine Learning
  段落数: 3
  ...

📊 导入摘要
============================================================
  总计: 4
  ✓ 成功: 4
  ✗ 失败: 0
  ⊗ 跳过: 0
```

### 3. 指定文章元数据

```bash
python import_articles.py --file article.txt \
  --title "Python编程基础" \
  --category "技术" \
  --difficulty beginner \
  --source "原创文章"
```

### 4. 批量导入目录

```bash
# 导入目录中所有 .txt 文件
python import_articles.py --dir ./my_articles/

# 导入特定类型的文件
python import_articles.py --dir ./books/ --pattern "*.md"

# 批量导入并设置统一分类
python import_articles.py --dir ./tech_articles/ --category "技术"
```

## 📝 命令行参数

### 必选参数（二选一）

| 参数 | 简写 | 说明 |
|------|------|------|
| `--file` | `-f` | 单个文件路径 |
| `--dir` | `-d` | 目录路径（批量导入） |

### 可选参数

| 参数 | 简写 | 说明 | 默认值 |
|------|------|------|--------|
| `--title` | `-t` | 文章标题 | 自动提取 |
| `--category` | `-c` | 文章分类 | 自动检测 |
| `--difficulty` | - | 难度：beginner/intermediate/advanced | 自动判断 |
| `--source` | `-s` | 文章来源 | "导入自: 文件名" |
| `--pattern` | `-p` | 文件匹配模式（仅用于目录） | `*.txt` |
| `--detect-chapters` | - | 自动检测书籍章节 | - |

## 🎯 使用场景

### 场景1：导入一篇英文文章

准备文件 `article.txt`:
```
The Future of Renewable Energy

Renewable energy sources are becoming increasingly important...

Wind power has seen tremendous growth...

Solar energy is one of the fastest growing...
```

导入：
```bash
python import_articles.py --file article.txt
```

**自动处理**：
- 标题：从第一行提取 "The Future of Renewable Energy"
- 分类：检测关键词，自动归为 "科学"
- 难度：根据单词复杂度判断为 "intermediate"
- 段落：自动分割并存储 3 个段落

### 场景2：导入一本书并分章节

准备文件 `python_guide.txt`:
```
Python Programming Guide

Chapter 1: Introduction to Python

Python is a high-level programming language...

Chapter 2: Variables and Data Types

In Python, variables are created when you assign...

Chapter 3: Control Flow

Control flow statements allow you to...
```

导入：
```bash
python import_articles.py --file python_guide.txt \
  --detect-chapters \
  --title "Python编程指南" \
  --category "技术"
```

**自动处理**：
- 检测到 3 个章节（Chapter 1, 2, 3）
- 创建 3 篇文章：
  - Python编程指南 - Chapter 1: Introduction to Python
  - Python编程指南 - Chapter 2: Variables and Data Types
  - Python编程指南 - Chapter 3: Control Flow

### 场景3：批量导入文章集合

目录结构：
```
articles/
  ├── ai_basics.txt
  ├── machine_learning.txt
  ├── deep_learning.txt
  └── neural_networks.txt
```

导入：
```bash
python import_articles.py --dir articles/ --category "技术" --difficulty intermediate
```

**结果**：一次性导入 4 篇文章，统一设置为"技术"分类和"中级"难度。

## 🔧 高级功能

### 1. 自动分类检测

脚本会根据文章内容自动检测分类：

| 检测到的关键词 | 自动分类 |
|---------------|---------|
| technology, programming, AI | 技术 |
| health, medical, fitness | 健康 |
| business, marketing, economy | 商业 |
| science, research, experiment | 科学 |
| education, learning, teaching | 教育 |
| literature, novel, story | 文学 |

### 2. 自动难度判断

根据单词平均长度判断难度：

- **平均长度 < 5** → beginner（初级）
- **5 ≤ 平均长度 < 6.5** → intermediate（中级）
- **平均长度 ≥ 6.5** → advanced（高级）

### 3. 章节检测模式

支持多种章节标记格式：

- `Chapter 1`, `Chapter 2` ...
- `CHAPTER 1`, `CHAPTER 2` ...
- `第一章`, `第二章` ...
- `1. Introduction`, `2. Background` ...

### 4. 多编码支持

自动尝试以下编码读取文件：
1. UTF-8
2. GBK
3. GB2312
4. UTF-16

### 5. 重复检测

如果文章标题已存在，会提示：
```
⚠ 文章已存在: Python编程基础
是否覆盖? (y/n):
```

## 📊 数据自动处理

导入时会自动处理以下数据：

| 字段 | 处理方式 |
|------|---------|
| `title` | 从第一行或文件名提取 |
| `content` | 清理多余空行，保留段落结构 |
| `word_count` | 自动统计英文单词数 |
| `paragraph_count` | 自动统计段落数 |
| `paragraphs` | 自动分割并存储段落数组 |
| `category` | 关键词检测或手动指定 |
| `difficulty` | 词汇复杂度判断或手动指定 |
| `source` | 记录导入来源 |

## 💡 使用技巧

### 技巧1：准备文章文件

**推荐格式**：
```
文章标题（可选，第一行）

第一段内容...

第二段内容...

第三段内容...
```

**注意**：
- 段落之间用**两个换行符**（空行）分隔
- 文章标题如果在第一行，应该简短（<100字符）
- 使用 UTF-8 编码保存最佳

### 技巧2：批量导入时的文件命名

```
good_examples:
  ✓ python_basics.txt
  ✓ machine-learning-intro.txt
  ✓ AI Development.txt

avoid:
  ✗ 1.txt (无意义的名称)
  ✗ temp.txt (不描述内容)
```

### 技巧3：书籍分章节导入

**章节标记建议**：
```
Chapter 1: 章节标题
或
第一章 章节标题
```

**完整章节结构**：
```
书名

Chapter 1: Introduction

第一章内容...

Chapter 2: Basics

第二章内容...
```

### 技巧4：验证导入结果

导入后可以检查：
```bash
# 查看数据库
python manage.py shell

>>> from articles.models import Article
>>> Article.objects.all()
>>> Article.objects.filter(category='技术')
>>> Article.objects.last()  # 查看最后导入的文章
```

## 🧪 测试示例

### 测试1：导入示例文章

```bash
python import_articles.py --file sample_article.txt
```

### 测试2：导入示例书籍

```bash
python import_articles.py --file sample_book.txt --detect-chapters
```

### 测试3：创建测试目录并批量导入

```bash
# 创建测试目录
mkdir test_articles
cp sample_article.txt test_articles/article1.txt
cp sample_book.txt test_articles/article2.txt

# 批量导入
python import_articles.py --dir test_articles/
```

## ❓ 常见问题

### Q: 文件编码错误怎么办？

A: 使用记事本或文本编辑器，将文件另存为 UTF-8 编码。

### Q: 如何删除导入错误的文章？

A: 在 Django 管理后台或使用 shell：
```python
from articles.models import Article
Article.objects.filter(title='错误的标题').delete()
```

### Q: 可以导入中文文章吗？

A: 可以，但目前单词统计只支持英文。中文文章的 `word_count` 会是 0。

### Q: 段落分割不正确怎么办？

A: 确保文章段落之间有**空行**（两个换行符 `\n\n`）。

### Q: 书籍没有检测到章节？

A: 确保章节标记格式正确，如 `Chapter 1:` 或 `第一章`。如果格式特殊，可以手动分割后再导入。

## 📋 完整命令参考

```bash
# 查看帮助
python import_articles.py --help

# 基础导入
python import_articles.py --file article.txt

# 完整参数
python import_articles.py \
  --file article.txt \
  --title "文章标题" \
  --category "技术" \
  --difficulty advanced \
  --source "原创"

# 书籍导入
python import_articles.py \
  --file book.txt \
  --detect-chapters \
  --title "书名"

# 批量导入
python import_articles.py \
  --dir ./articles/ \
  --pattern "*.txt" \
  --category "科学"
```

## 🎉 最佳实践

1. **单个文件**：使用 `--file` 并让脚本自动检测元数据
2. **书籍**：使用 `--detect-chapters` 自动分章节
3. **批量导入**：使用 `--dir` 并设置统一分类
4. **中文内容**：保存为 UTF-8 编码
5. **验证结果**：导入后到阅读页面检查效果

---

**现在就试试吧！** 🚀

```bash
python import_articles.py --file sample_article.txt
```

