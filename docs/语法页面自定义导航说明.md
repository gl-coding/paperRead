# 语法页面自定义导航说明

## 📋 功能概述

"英语语法"和"语法文章"两个导航tab现在已加入系统设置的自定义导航栏功能，用户可以根据自己的需求选择是否在导航栏中显示这些页面。

## ✨ 新增功能

### 1. 可自定义的导航项

在系统设置页面的"导航栏设置"中，新增了两个可配置的导航项：

- 📝 **英语语法** - 语法知识学习页面
- 📖 **语法文章** - 语法文章管理页面

### 2. 灵活的导航栏配置

用户现在可以自由选择显示或隐藏以下导航项：

✅ **可自定义项**：
- 📖 阅读文章
- 📚 文章列表
- 📝 英语语法 🆕
- 📖 语法文章 🆕
- 🔗 单词关系
- ✍️ 单词默写
- 👤 个人中心

🔒 **必选项**：
- ⚙️ 系统设置（始终显示，不可取消）

## 🎯 使用场景

### 场景 1: 简化导航栏

**需求**：只使用基本的阅读功能，不需要语法学习相关页面

**操作**：
1. 打开"系统设置"页面
2. 在"导航栏设置"中取消勾选"英语语法"和"语法文章"
3. 刷新页面

**效果**：导航栏中不再显示这两个tab，界面更简洁

### 场景 2: 专注语法学习

**需求**：专注于语法学习，不需要单词练习功能

**操作**：
1. 打开"系统设置"
2. 保持"英语语法"和"语法文章"勾选
3. 取消勾选"单词关系"和"单词默写"
4. 刷新页面

**效果**：导航栏重点突出语法学习相关功能

### 场景 3: 自定义学习流程

**需求**：根据个人学习习惯自定义导航栏

**操作**：
1. 在系统设置中根据使用频率勾选需要的页面
2. 保存设置并刷新

**效果**：导航栏只显示常用功能，提高使用效率

## 🔧 技术实现

### 1. 设置页面更新

**文件**: `settings.html`

在"导航栏设置"部分添加了两个新的复选框：

```html
<label class="nav-tab-item">
    <input type="checkbox" id="navGrammar" data-nav="grammar" checked>
    <span class="nav-tab-label">📝 英语语法</span>
</label>
<label class="nav-tab-item">
    <input type="checkbox" id="navGrammarArticles" data-nav="grammar_articles" checked>
    <span class="nav-tab-label">📖 语法文章</span>
</label>
```

**关键属性**：
- `id`: 唯一标识符
- `data-nav`: 导航项的键名（与 `navbar-control.js` 中的映射对应）
- `checked`: 默认选中状态

### 2. 导航控制脚本更新

**文件**: `navbar-control.js`

#### 默认值配置

```javascript
const defaults = {
    reading: true,
    articles: true,
    grammar: true,              // 🆕 新增
    grammar_articles: true,     // 🆕 新增
    words: true,
    dictation: true,
    profile: true,
    settings: true
};
```

#### 页面映射配置

```javascript
const navMapping = {
    'reading': 'index.html',
    'articles': 'articles_manager.html',
    'grammar': 'grammar.html',                      // 🆕 新增
    'grammar_articles': 'grammar_articles.html',    // 🆕 新增
    'words': 'words_graph.html',
    'dictation': 'dictation.html',
    'profile': 'profile.html',
    'settings': 'settings.html'
};
```

### 3. 设置管理脚本更新

**文件**: `settings.js`

更新默认值配置以支持新的导航项：

```javascript
const defaults = {
    reading: true,
    articles: true,
    grammar: true,              // 🆕 新增
    grammar_articles: true,     // 🆕 新增
    words: true,
    dictation: true,
    profile: true,
    settings: true
};
```

## 📊 工作流程

### 保存设置流程

```
用户勾选/取消勾选
        ↓
触发 change 事件
        ↓
settings.js - saveNavSettings()
        ↓
读取所有复选框状态
        ↓
保存到 localStorage ('navTabs')
        ↓
显示通知："设置已保存，刷新页面生效"
```

### 应用设置流程

```
页面加载
        ↓
navbar-control.js (IIFE 立即执行)
        ↓
读取 localStorage ('navTabs')
        ↓
合并默认值和用户设置
        ↓
生成 CSS 隐藏规则
        ↓
立即插入到 <head> (避免闪烁)
        ↓
DOMContentLoaded 后再次确认应用
```

## 🎨 用户体验优化

### 1. 无闪烁加载

通过在 `<head>` 中立即加载 `navbar-control.js`，并在 DOM 解析前就注入隐藏样式，确保页面加载时不会出现导航项先显示后隐藏的闪烁效果。

```html
<head>
    <link rel="stylesheet" href="navbar.css">
    <script src="navbar-control.js"></script>  <!-- 立即执行 -->
</head>
```

### 2. 持久化存储

使用 `localStorage` 存储用户的导航栏配置，确保：
- ✅ 配置在刷新后保持
- ✅ 配置在不同页面间同步
- ✅ 配置在浏览器会话间保留

### 3. 友好的反馈

- 💬 保存设置时显示通知："导航栏设置已保存，刷新页面生效"
- 🎯 通知自动消失，不干扰用户操作
- 🎨 带动画效果的通知提示

## 💡 使用建议

### 1. 新用户

**建议**：保持所有导航项开启
- 可以全面体验所有功能
- 熟悉各个模块后再根据需求自定义

### 2. 专注阅读用户

**建议**：只保留阅读相关功能
- ✅ 阅读文章
- ✅ 文章列表
- ✅ 个人中心
- ✅ 系统设置
- ❌ 其他功能（按需开启）

### 3. 语法学习用户

**建议**：重点保留语法相关功能
- ✅ 阅读文章
- ✅ 文章列表
- ✅ 英语语法
- ✅ 语法文章
- ❌ 单词关系、单词默写（按需开启）

### 4. 全功能用户

**建议**：保持所有功能开启
- 完整的学习工具箱
- 根据不同学习阶段灵活使用

## 🔍 技术细节

### localStorage 数据结构

```json
{
  "navTabs": {
    "reading": true,
    "articles": true,
    "grammar": true,
    "grammar_articles": true,
    "words": false,
    "dictation": false,
    "profile": true,
    "settings": true
  }
}
```

### CSS 隐藏规则

当用户取消勾选某个导航项时，系统会动态生成 CSS 规则：

```css
/* 隐藏"英语语法"导航项 */
a.nav-item[href="grammar.html"] { 
    display: none !important; 
}

/* 隐藏"语法文章"导航项 */
a.nav-item[href="grammar_articles.html"] { 
    display: none !important; 
}
```

### 防闪烁技术

1. **立即执行的 IIFE**：脚本使用立即执行函数表达式（IIFE），在 DOM 解析前就开始执行

2. **同步注入样式**：直接创建 `<style>` 元素并添加到 `<head>`，而不是等待 DOM Ready

3. **双重保障**：在 `DOMContentLoaded` 事件中再次应用设置，确保万无一失

```javascript
// 立即执行
(function() {
    // 生成 CSS 并立即插入
    const style = document.createElement('style');
    style.textContent = cssRules;
    document.head.appendChild(style);
    
    // DOM Ready 后再次确认
    document.addEventListener('DOMContentLoaded', applyNavbarSettings);
})();
```

## 📝 相关文件

### 核心文件

1. **`settings.html`** - 系统设置页面（UI）
2. **`settings.js`** - 设置管理逻辑（保存/加载）
3. **`navbar-control.js`** - 导航栏控制逻辑（显示/隐藏）

### 受影响的文件

所有包含导航栏的页面都会自动应用导航栏设置：
- `index.html`
- `articles_manager.html`
- `grammar.html`
- `grammar_articles.html`
- `words_graph.html`
- `dictation.html`
- `profile.html`
- `settings.html`

## 🔗 相关文档

- [导航栏更新说明.md](./导航栏更新说明.md) - 导航栏基本功能
- [导航栏顺序调整说明.md](./导航栏顺序调整说明.md) - 导航栏顺序优化
- [英语语法页面加载语法文章说明.md](./英语语法页面加载语法文章说明.md) - 语法页面功能
- [语法文章双表管理说明.md](./语法文章双表管理说明.md) - 语法文章管理

## 📅 更新日志

- **2025-10-25**: 初始版本
  - "英语语法"和"语法文章"加入自定义导航栏
  - 更新 `settings.html` 添加新的复选框
  - 更新 `navbar-control.js` 支持新的导航项映射
  - 更新 `settings.js` 默认值配置
  - 完善文档说明

---

**提示**：设置保存后需要刷新页面才能看到效果。如果导航栏没有变化，请检查浏览器控制台是否有错误信息。

