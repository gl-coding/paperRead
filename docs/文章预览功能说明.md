# 文章预览功能说明

## ✨ 功能概述

在语法文章页面新增了**快速预览**功能，用户无需跳转页面即可在对话框中查看文章完整内容。

---

## 🎯 使用场景

### 适用情况
- 快速浏览文章内容
- 确认文章是否是想要的
- 在不跳转页面的情况下阅读短文章
- 对比多篇文章内容

### 与"查看"按钮的区别

| 功能 | 预览 🔍 | 查看 👁️ |
|------|---------|---------|
| **展示方式** | 对话框内显示 | 跳转到阅读页面 |
| **功能完整性** | 纯文本预览 | 完整阅读功能（标注、翻译、朗读） |
| **页面状态** | 保持当前列表 | 离开列表页面 |
| **适用场景** | 快速浏览 | 深度阅读学习 |

---

## 🔍 功能界面

### 预览对话框结构

```
┌─────────────────────────────────────────┐
│  Present Perfect Tense              [✕] │ ← 标题
├─────────────────────────────────────────┤
│  [中级] [时态] 字数：350 | 段落：5       │ ← 信息栏
├─────────────────────────────────────────┤
│                                          │
│  文章内容区域                             │
│  (可滚动)                                │
│                                          │
│  This tense is used to describe...      │
│                                          │
│  Examples:                               │
│  1. I have finished my homework.        │
│  2. She has lived here for 5 years.     │
│                                          │
├─────────────────────────────────────────┤
│              [关闭] [打开阅读模式]        │ ← 操作按钮
└─────────────────────────────────────────┘
```

### 按钮布局

现在每个文章卡片底部有**4个按钮**：

```
┌────────────────────────────────────────┐
│  [🔍 预览] [👁️ 查看] [✏️ 编辑] [🗑️ 删除] │
└────────────────────────────────────────┘
```

---

## 🎨 设计特点

### 1. 预览按钮

**样式**：
- 背景：天蓝渐变 (#4facfe → #00f2fe)
- 图标：🔍
- 悬停：上浮 + 蓝色阴影

**位置**：操作按钮的第一个（最左侧）

### 2. 预览对话框

**尺寸**：
- 桌面端：最大宽度 900px
- 移动端：95% 宽度
- 高度：最大 85vh

**内容区域**：
- 信息栏：显示难度、分类、字数、段落数
- 内容区：可滚动，支持长文章
- 底部按钮：关闭 / 打开阅读模式

**样式特点**：
- 现代化设计，圆角卡片
- 渐变背景的信息栏
- 舒适的行高（1.8）
- 段落间距合理
- 平滑滚动

---

## 🚀 使用方法

### 快速预览文章

1. **点击预览按钮**
   - 在文章卡片底部点击 `🔍 预览`

2. **查看文章内容**
   - 对话框自动打开并显示"加载中..."
   - 加载完成后显示完整文章内容
   - 可以滚动查看长文章

3. **关闭预览**
   - 点击右上角 `✕` 按钮
   - 点击底部 `关闭` 按钮
   - 点击对话框背景区域（外部点击关闭）

### 从预览跳转到阅读模式

如果预览后想深度学习：

1. 在预览对话框中点击 `打开阅读模式`
2. 自动关闭预览对话框
3. 跳转到英语语法页面，显示完整功能

---

## 💻 技术实现

### 前端实现

**HTML 结构**（`grammar_articles.html`）：

```html
<!-- 文章预览模态框 -->
<div id="previewModal" class="modal">
    <div class="modal-content modal-preview">
        <div class="modal-header">
            <h2 id="previewTitle">文章预览</h2>
            <button class="modal-close" id="closePreviewModal">✕</button>
        </div>
        <div class="modal-body">
            <!-- 信息栏 -->
            <div class="preview-info">
                <span class="preview-badge" id="previewDifficulty">中级</span>
                <span class="preview-category" id="previewCategory">分类</span>
                <span class="preview-meta" id="previewMeta">字数：0 | 段落：0</span>
            </div>
            <!-- 内容区 -->
            <div class="preview-content" id="previewContent">
                <div class="loading">加载中...</div>
            </div>
            <!-- 操作按钮 -->
            <div class="preview-actions">
                <button class="btn btn-secondary" onclick="closePreviewModal()">关闭</button>
                <button class="btn btn-primary" id="openFullArticle">打开阅读模式</button>
            </div>
        </div>
    </div>
</div>
```

**JavaScript 函数**（`grammar_articles.js`）：

```javascript
// 预览文章
async function previewArticle(id) {
    // 根据当前tab选择API端点
    let apiEndpoint = currentTab === 'grammar' 
        ? 'grammar-articles' 
        : 'user-grammar-articles';
    
    // 显示模态框
    const previewModal = document.getElementById('previewModal');
    previewModal.style.display = 'flex';
    
    // 获取文章详情
    const response = await fetch(`${API_BASE_URL}/${apiEndpoint}/${id}/`);
    const article = await response.json();
    
    // 更新内容
    // ...
}

// 关闭预览
function closePreviewModal() {
    document.getElementById('previewModal').style.display = 'none';
}
```

**CSS 样式**（`grammar_articles.css`）：

```css
/* 预览按钮 */
.btn-preview {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.btn-preview:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
}

/* 预览模态框 */
.modal-preview {
    max-width: 900px;
    max-height: 85vh;
}

.preview-content {
    overflow-y: auto;
    padding: 20px;
    background: #fafafa;
    border-radius: 8px;
    line-height: 1.8;
}
```

---

## 📱 响应式设计

### 桌面端（> 768px）

**预览对话框**：
- 宽度：最大 900px
- 信息栏：横向布局
- 按钮：横向排列，右对齐

**按钮布局**：
- 四个按钮横向并排
- 预览按钮占25%宽度

### 移动端（≤ 768px）

**预览对话框**：
- 宽度：95%
- 高度：90vh（更高，适配小屏幕）
- 信息栏：竖向布局
- 按钮：竖向排列，全宽

**按钮布局**：
- 四个按钮自动换行
- 每行显示2个
- 预览和查看在第一行
- 编辑和删除在第二行

---

## 🔧 交互细节

### 加载状态

**显示时机**：
- 点击预览按钮后立即显示
- API请求期间持续显示

**显示内容**：
```
加载中...
```

### 错误处理

**错误情况**：
- API请求失败
- 网络连接问题
- 文章不存在

**显示内容**：
```
加载失败，请重试
```

### 内容格式化

**段落处理**：
- 以双换行符 `\n\n` 分割段落
- 每个段落包裹在 `<p>` 标签中
- 段落内换行转换为 `<br>`

**HTML转义**：
- 使用 `escapeHtml()` 函数
- 防止XSS攻击
- 保留文本格式

### 多种关闭方式

1. **点击关闭按钮**：右上角 `✕`
2. **点击关闭按钮**：底部 `关闭`
3. **外部点击**：点击对话框背景
4. **跳转关闭**：点击"打开阅读模式"自动关闭

---

## 🎯 使用技巧

### 快速浏览多篇文章

1. 在列表中点击 `🔍 预览`
2. 快速浏览内容
3. 按 `ESC` 或点击背景关闭
4. 继续预览下一篇
5. 找到目标文章后点击 `打开阅读模式`

### 对比文章内容

1. 预览第一篇文章，记住要点
2. 关闭预览
3. 预览第二篇文章进行对比
4. 选择更合适的文章深度学习

### 快速确认文章难度

1. 点击预览按钮
2. 查看信息栏的难度标签
3. 浏览前几段内容
4. 判断是否适合当前水平

---

## 🐛 常见问题

### Q1: 点击预览没有反应

**可能原因**：
- JavaScript错误
- API端点问题
- 网络连接失败

**解决方法**：
1. 打开浏览器Console查看错误
2. 检查Network请求状态
3. 确认后端服务运行正常

### Q2: 预览对话框显示不完整

**可能原因**：
- CSS样式冲突
- 浏览器兼容性问题

**解决方法**：
1. 刷新页面（Ctrl+F5 强制刷新）
2. 清除浏览器缓存
3. 更新到最新版浏览器

### Q3: 移动端预览对话框太小

**说明**：
- 这是正常的，移动端会自适应屏幕
- 对话框宽度为 95%，高度为 90vh
- 内容区域可以滚动查看

### Q4: 预览内容没有格式

**说明**：
- 预览功能只显示纯文本
- 不包含标注、翻译等功能
- 如需完整功能，使用"查看"按钮

---

## 📊 功能对比

### 预览 vs 查看 vs 编辑

| 功能项 | 🔍 预览 | 👁️ 查看 | ✏️ 编辑 |
|--------|---------|---------|---------|
| 打开方式 | 对话框 | 新页面 | 对话框 |
| 显示内容 | 完整文章 | 完整文章 | 可编辑表单 |
| 词汇标注 | ❌ | ✅ | ❌ |
| 句子标注 | ❌ | ✅ | ❌ |
| 翻译功能 | ❌ | ✅ | ❌ |
| 朗读功能 | ❌ | ✅ | ❌ |
| 可编辑 | ❌ | ❌ | ✅ |
| 保持列表 | ✅ | ❌ | ✅ |
| 加载速度 | 快 | 中 | 快 |

---

## 🎨 自定义扩展

### 修改预览对话框大小

在 `grammar_articles.css` 中：

```css
.modal-preview {
    max-width: 1200px;  /* 改为更大 */
    max-height: 90vh;   /* 改为更高 */
}
```

### 修改预览按钮颜色

在 `grammar_articles.css` 中：

```css
.article-actions .btn-preview {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    /* 改为绿色渐变 */
}
```

### 添加打印功能

在 `grammar_articles.js` 的预览对话框中添加：

```javascript
// 添加打印按钮
<button class="btn btn-secondary" onclick="printPreview()">
    🖨️ 打印
</button>

// 实现打印函数
function printPreview() {
    const content = document.getElementById('previewContent').innerHTML;
    const win = window.open('', '', 'height=700,width=700');
    win.document.write('<html><head><title>打印预览</title>');
    win.document.write('</head><body>');
    win.document.write(content);
    win.document.write('</body></html>');
    win.document.close();
    win.print();
}
```

---

## ✅ 验证清单

功能正常的标志：

- [ ] 每个文章卡片显示4个操作按钮
- [ ] 预览按钮为天蓝色渐变
- [ ] 点击预览后立即显示对话框
- [ ] 对话框显示"加载中..."状态
- [ ] 加载完成后显示完整文章内容
- [ ] 信息栏正确显示难度、分类、字数等
- [ ] 内容区域可以滚动
- [ ] 点击"关闭"可以关闭对话框
- [ ] 点击对话框背景可以关闭
- [ ] 点击"打开阅读模式"跳转到阅读页面
- [ ] 移动端按钮自动换行且布局合理

---

## 🚀 未来扩展

可能的功能增强：

1. **分享功能**
   - 生成文章链接
   - 一键复制

2. **收藏快捷**
   - 在预览对话框中添加收藏按钮
   - 无需关闭即可收藏

3. **字体控制**
   - 调整预览文字大小
   - 切换字体样式

4. **朗读预览**
   - 在预览对话框中添加朗读按钮
   - 简化版朗读功能

5. **下载/导出**
   - 导出为PDF
   - 导出为TXT

---

**更新日期**：2025-10-25  
**版本**：v1.0  
**作者**：DL Page Team

